<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regression Diagnostics Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #1f2937;
        }

        .equation-box {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .equation {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            margin-top: 8px;
        }

        .chart-container {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
        }

        .note-box {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            color: #374151;
        }

        .note-label {
            font-weight: bold;
            color: #dc2626;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        th {
            background: #e5e7eb;
            padding: 12px;
            text-align: left;
            border: 1px solid #d1d5db;
            font-weight: 600;
        }

        th.center {
            text-align: center;
            width: 96px;
        }

        td {
            padding: 12px;
            border: 1px solid #d1d5db;
            position: relative;
        }

        tr:hover {
            background: #f9fafb;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .toggle-switch {
            position: relative;
            display: inline-flex;
            align-items: center;
            width: 44px;
            height: 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .toggle-switch.lower {
            background-color: #3b82f6;
        }

        .toggle-switch.higher {
            background-color: #10b981;
        }

        .toggle-knob {
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
            top: 4px;
        }

        .toggle-knob.lower {
            transform: translateX(4px);
        }

        .toggle-knob.higher {
            transform: translateX(24px);
        }

        .toggle-label {
            font-size: 12px;
            text-align: center;
            margin-top: 4px;
        }

        .effect-text {
            transition: color 0.2s;
        }

        .effect-text.lower {
            color: #2563eb;
        }

        .effect-text.higher {
            color: #059669;
        }

        .legend {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            margin-right: 8px;
        }

        .legend-color.lower {
            background-color: #2563eb;
        }

        .legend-color.higher {
            background-color: #059669;
        }

        .tooltip {
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
            width: 256px;
            z-index: 10;
            left: 100%;
            margin-left: 8px;
            top: -4px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .tooltip-trigger:hover .tooltip {
            opacity: 1;
        }

        .tooltip::before {
            content: '';
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            border: 4px solid transparent;
            border-right-color: #1f2937;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .equation {
                font-size: 14px;
            }
            
            .chart-container svg {
                width: 100%;
                height: auto;
            }
            
            .tooltip {
                position: fixed;
                left: 50% !important;
                transform: translateX(-50%);
                margin-left: 0;
                top: 10px;
                width: 90%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Regression Equation Display -->
        <div class="section">
            <div class="equation-box">
                <h2 class="section-title">Equation of the Regression Predicting 20X2 Sales</h2>
                <div class="equation">
                    20X2_Sales = Intercept + A1 × 20X1_Sales + A2 × Sales_Employees + Residual
                </div>
            </div>
        </div>

        <!-- Visual Plot of the Regression -->
        <div class="section">
            <h2 class="section-title">Visual Plot of the Regression Predicting 20X2 Sales of 20 Stores</h2>
            <div class="chart-container">
                <svg width="600" height="650" viewBox="0 0 780 830">
                    <!-- Grid lines -->
                    <g stroke="#ddd" stroke-width="1">
                        <!-- Vertical grid lines -->
                        <line x1="160" y1="20" x2="160" y2="740" />
                        <line x1="225" y1="20" x2="225" y2="740" />
                        <line x1="290" y1="20" x2="290" y2="740" />
                        <line x1="355" y1="20" x2="355" y2="740" />
                        <line x1="420" y1="20" x2="420" y2="740" />
                        <line x1="485" y1="20" x2="485" y2="740" />
                        <line x1="550" y1="20" x2="550" y2="740" />
                        <line x1="615" y1="20" x2="615" y2="740" />
                        <line x1="680" y1="20" x2="680" y2="740" />
                        
                        <!-- Horizontal grid lines -->
                        <line x1="95" y1="100" x2="745" y2="100" />
                        <line x1="95" y1="180" x2="745" y2="180" />
                        <line x1="95" y1="260" x2="745" y2="260" />
                        <line x1="95" y1="340" x2="745" y2="340" />
                        <line x1="95" y1="420" x2="745" y2="420" />
                        <line x1="95" y1="500" x2="745" y2="500" />
                        <line x1="95" y1="580" x2="745" y2="580" />
                        <line x1="95" y1="660" x2="745" y2="660" />
                    </g>
                    
                    <!-- Axes -->
                    <line x1="95" y1="20" x2="95" y2="740" stroke="black" stroke-width="2" />
                    <line x1="95" y1="740" x2="745" y2="740" stroke="black" stroke-width="2" />
                    
                    <!-- X-axis labels -->
                    <text x="420" y="785" text-anchor="middle" font-size="16">Predicted 20X2 Sales (i.e., composite of all independent variables)</text>
                    <text x="160" y="760" text-anchor="middle" font-size="14">20</text>
                    <text x="225" y="760" text-anchor="middle" font-size="14">30</text>
                    <text x="290" y="760" text-anchor="middle" font-size="14">40</text>
                    <text x="355" y="760" text-anchor="middle" font-size="14">50</text>
                    <text x="420" y="760" text-anchor="middle" font-size="14">60</text>
                    <text x="485" y="760" text-anchor="middle" font-size="14">70</text>
                    <text x="550" y="760" text-anchor="middle" font-size="14">80</text>
                    <text x="615" y="760" text-anchor="middle" font-size="14">90</text>
                    <text x="680" y="760" text-anchor="middle" font-size="14">100</text>
                    
                    <!-- Y-axis labels -->
                    <text x="30" y="380" text-anchor="middle" font-size="16" transform="rotate(-90, 30, 380)">Actual 20X2 Sales</text>
                    <text x="85" y="660" text-anchor="end" font-size="14">20</text>
                    <text x="85" y="580" text-anchor="end" font-size="14">30</text>
                    <text x="85" y="500" text-anchor="end" font-size="14">40</text>
                    <text x="85" y="420" text-anchor="end" font-size="14">50</text>
                    <text x="85" y="340" text-anchor="end" font-size="14">60</text>
                    <text x="85" y="260" text-anchor="end" font-size="14">70</text>
                    <text x="85" y="180" text-anchor="end" font-size="14">80</text>
                    <text x="85" y="100" text-anchor="end" font-size="14">90</text>
                    
                    <!-- Regression Line -->
                    <line x1="95" y1="580" x2="745" y2="100" stroke="red" stroke-width="2" />
                    
                    <!-- Legend -->
                    <g transform="translate(150, 45)">
                        <rect x="0" y="0" width="230" height="60" fill="white" stroke="#ccc" stroke-width="1" />
                        
                        <!-- X symbol aligned -->
                        <g transform="translate(15, 20)">
                            <line x1="-5" y1="-5" x2="5" y2="5" stroke="green" stroke-width="2" />
                            <line x1="-5" y1="5" x2="5" y2="-5" stroke="green" stroke-width="2" />
                        </g>
                        <text x="35" y="25" font-size="16">Actual Sales</text>
                        
                        <!-- Line symbol aligned -->
                        <line x1="10" y1="45" x2="25" y2="45" stroke="red" stroke-width="2" />
                        <text x="35" y="50" font-size="16">Regression Line</text>
                    </g>
                    
                    <!-- Data Points -->
                    <g fill="green" stroke="green" stroke-width="2">
                        <!-- Sample data points as X marks -->
                        <g transform="translate(95,660)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(125,675)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(160,575)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(190,525)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(225,575)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(260,460)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(290,500)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(320,340)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(355,350)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(390,300)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(420,380)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(455,280)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(485,300)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(520,220)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(550,180)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(585,150)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(615,180)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(645,120)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(680,100)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                        <g transform="translate(710,130)">
                            <line x1="-5" y1="-5" x2="5" y2="5" />
                            <line x1="-5" y1="5" x2="5" y2="-5" />
                        </g>
                    </g>
                    
                    <!-- Residual annotation -->
                    <g>
                        <line x1="320" y1="410" x2="320" y2="345" stroke="black" stroke-dasharray="5,5" stroke-width="1" />
                        <text x="245" y="390" font-size="16" fill="black">Residual</text>
                    </g>
                </svg>
            </div>
        </div>
        
        <!-- Note about intercept -->
        <div class="section">
            <div class="note-box">
                <p>
                    <span class="note-label">Note:</span> In auditing practice we would typically set the intercept to zero, but in this example—just to illustrate how regressions work—we let the model calculate it. The result is an intercept of 30, which represents the baseline level of 20X2 Sales when all predictors (i.e., independent variables) are zero. Importantly, it's the deviations from that baseline—that is, the residuals—that auditors focus on to flag potential misstatements.
                </p>
            </div>
        </div>

        <!-- Interactive Table -->
        <div class="section">
            <h2 class="section-title">Effect of Components</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th class="center">Change</th>
                            <th>Effect</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color lower"></div>
                    <span>Lower</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color higher"></div>
                    <span>Higher</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application state
        const toggles = {
            variables: false,
            rSquared: false,
            observations: false,
            pValue: false,
            residual: false
        };

        // Component data
        const components = [
            {
                name: "Number of independent variables (e.g., 20X1_Sales, Sales_Employees, etc.)",
                key: "variables",
                lowerEffect: "Regressions can work even with one independent variable.",
                higherEffect: "More variables can improve prediction if they're relevant—but irrelevant variables may reduce reliability."
            },
            {
                name: "R² (coefficient of determination)",
                key: "rSquared",
                lowerEffect: "The regression explains less variation in sales—less predictive power.",
                higherEffect: "The regression explains more variation in sales—better predictive power."
            },
            {
                name: "Number of observations",
                key: "observations",
                lowerEffect: "The regression has less power to detect real patterns—results are less reliable.",
                higherEffect: "The regression has more power to detect meaningful relationships."
            },
            {
                name: "p-value",
                key: "pValue",
                lowerEffect: "The observed relationship is less likely due to chance—this supports reliability.",
                higherEffect: "The observed relationship is more likely due to chance—be cautious."
            },
            {
                name: "Magnitude of residual",
                key: "residual",
                lowerEffect: "Differences between predicted and actual sales are smaller—less likely to indicate a material misstatement.",
                higherEffect: "Differences are larger—more likely to signal a material misstatement."
            }
        ];

        // Tooltips
        const tooltips = {
            "R² (coefficient of determination)": "Measures how well the regression model explains the variation in the dependent variable (0-100%).",
            "p-value": "Indicates the statistical significance of the relationship. Lower p-values suggest stronger evidence against the null hypothesis.",
            "Magnitude of residual": "The difference between the actual value and the predicted value from the regression model."
        };

        // Handle toggle changes
        function handleToggle(componentKey) {
            toggles[componentKey] = !toggles[componentKey];
            renderTable();
        }

        // Render the table
        function renderTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            components.forEach(component => {
                const isHigher = toggles[component.key];
                const effectText = isHigher ? component.higherEffect : component.lowerEffect;
                const stateClass = isHigher ? 'higher' : 'lower';
                const stateLabel = isHigher ? 'Higher' : 'Lower';

                const row = document.createElement('tr');
                
                // Component name cell with tooltip
                const nameCell = document.createElement('td');
                nameCell.className = 'tooltip-trigger';
                nameCell.innerHTML = component.name;
                
                if (tooltips[component.name]) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = tooltips[component.name];
                    nameCell.appendChild(tooltip);
                }

                // Toggle cell
                const toggleCell = document.createElement('td');
                toggleCell.innerHTML = `
                    <div class="toggle-container">
                        <div class="toggle-switch ${stateClass}" onclick="handleToggle('${component.key}')">
                            <span class="toggle-knob ${stateClass}"></span>
                        </div>
                        <div class="toggle-label">${stateLabel}</div>
                    </div>
                `;

                // Effect cell
                const effectCell = document.createElement('td');
                effectCell.className = `effect-text ${stateClass}`;
                effectCell.textContent = effectText;

                row.appendChild(nameCell);
                row.appendChild(toggleCell);
                row.appendChild(effectCell);
                tableBody.appendChild(row);
            });
        }

        // Initialize the application
        function init() {
            renderTable();
        }

        // Initialize when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>

<!-- Add near the end of index.html, before </body> -->
<footer style="margin-top:24px;padding-top:12px;border-top:1px solid #eee;font-size:.9rem;color:#666;text-align:center">
  © 2025 Eldar Maksymov • <a href="https://github.com/eldarmaksymov/ARM_calculator/blob/main/LICENSE" target="_blank" rel="noopener">MIT License</a>
</footer>

</body>
</html>
